<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaaS Trading Portal - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .header {
            background: white;
            padding: 20px 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 { color: #667eea; font-size: 1.8em; }
        .header .user-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 30px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 10px;
        }
        .tab {
            padding: 12px 24px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .tab.active {
            background: #667eea;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        .strategy-card {
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }
        .strategy-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
        }
        .strategy-card.top-rated {
            border-color: #ffd700;
            background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
        }
        .strategy-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        .strategy-name {
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
        }
        .rating {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        .star {
            color: #ffd700;
            font-size: 1.2em;
        }
        .rating-number {
            font-weight: 600;
            color: #667eea;
            margin-left: 5px;
        }
        .strategy-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
            font-size: 0.9em;
        }
        .metric {
            display: flex;
            justify-content: space-between;
        }
        .metric-label { color: #666; }
        .metric-value { font-weight: 600; color: #333; }
        .profit { color: #10b981; }
        .loss { color: #ef4444; }
        .strategy-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-primary:hover { background: #5568d3; }
        .btn-success {
            background: #10b981;
            color: white;
        }
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        .modal.active { display: flex; justify-content: center; align-items: start; padding: 40px 20px; }
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            margin-top: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .form-group textarea {
            min-height: 200px;
            font-family: monospace;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .config-preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
        }
        .top-strategies {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .top-strategy-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            position: relative;
        }
        .top-strategy-item::before {
            content: '‚≠ê';
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 2em;
        }
        .login-form {
            max-width: 400px;
            margin: 100px auto;
        }
        .hidden { display: none !important; }
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="card login-form">
        <h2 style="text-align: center; margin-bottom: 30px; color: #667eea;">üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
        <div class="form-group">
            <label>Username:</label>
            <input type="text" id="login-username" placeholder="–í–∞—à username">
        </div>
        <div class="form-group">
            <label>Password:</label>
            <input type="password" id="login-password" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å">
        </div>
        <button class="btn btn-primary" style="width: 100%;" onclick="login()">–í–æ–π—Ç–∏</button>
        <p style="text-align: center; margin-top: 20px; color: #666;">
            –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" onclick="showRegister()" style="color: #667eea;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
        </p>
    </div>

    <!-- Main App (hidden until login) -->
    <div id="main-app" class="hidden">
        <div class="header">
            <h1>üöÄ SaaS Trading Portal</h1>
            <div class="user-info">
                <span id="user-display"></span>
                <button class="btn btn-danger" onclick="logout()">–í—ã–π—Ç–∏</button>
            </div>
        </div>

        <div class="container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('my-strategies')">üìä –ú–æ–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</button>
                <button class="tab" onclick="switchTab('create-strategy')">‚ûï –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</button>
                <button class="tab" onclick="switchTab('top-strategies')">‚≠ê –¢–æ–ø —Å—Ç—Ä–∞—Ç–µ–≥–∏–π</button>
                <button class="tab" onclick="switchTab('backtest')">üß™ –ë—ç–∫—Ç–µ—Å—Ç—ã</button>
            </div>

            <!-- My Strategies Tab -->
            <div id="my-strategies" class="tab-content active">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">–ú–æ–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h2>
                    <div id="strategies-list" class="strategy-grid"></div>
                </div>
            </div>

            <!-- Create Strategy Tab -->
            <div id="create-strategy" class="tab-content">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</h2>
                    <div class="form-group">
                        <label>–ò–º—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:</label>
                        <input type="text" id="new-strategy-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: EMA Reversal BTC">
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                        <textarea id="new-strategy-desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>–ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å (USDT):</label>
                            <input type="number" id="new-strategy-balance" value="1000" min="100">
                        </div>
                        <div class="form-group">
                            <label>–ü–ª–µ—á–æ:</label>
                            <select id="new-strategy-leverage">
                                <option value="3">3x</option>
                                <option value="5">5x</option>
                                <option value="10" selected>10x</option>
                                <option value="21">21x</option>
                                <option value="40">40x</option>
                                <option value="50">50x</option>
                                <option value="80">80x</option>
                                <option value="100">100x</option>
                                <option value="125">125x</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (##Begin_Strategy ... ##End_Strategy):</label>
                        <textarea id="new-strategy-config" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏..."></textarea>
                        <small style="color: #666;">–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≥–æ—Ç–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π</small>
                    </div>
                    <div class="config-preview" id="config-preview" style="display: none;"></div>
                    <div class="form-group">
                        <button class="btn btn-success" onclick="parseConfig()">–ü–∞—Ä—Å–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥</button>
                        <button class="btn btn-primary" onclick="saveStrategy()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</button>
                    </div>
                </div>
            </div>

            <!-- Top Strategies Tab -->
            <div id="top-strategies" class="tab-content">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">‚≠ê –¢–æ–ø —Å—Ç—Ä–∞—Ç–µ–≥–∏–π (–ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É)</h2>
                    <div id="top-strategies-list" class="top-strategies"></div>
                </div>
            </div>

            <!-- Backtest Tab -->
            <div id="backtest" class="tab-content">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">üß™ –ó–∞–ø—É—Å–∫ –±—ç–∫—Ç–µ—Å—Ç–∞</h2>
                    <div class="form-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é:</label>
                        <select id="backtest-strategy"></select>
                    </div>
                    <div class="form-group">
                        <label>–°–∏–º–≤–æ–ª:</label>
                        <select id="backtest-symbol">
                            <option value="BTC_USDT">BTC/USDT</option>
                            <option value="ETH_USDT">ETH/USDT</option>
                            <option value="SOL_USDT">SOL/USDT</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="runBacktest()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫—Ç–µ—Å—Ç</button>
                    <div id="backtest-results" style="margin-top: 30px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let authToken = localStorage.getItem('authToken');
        let currentUser = null;

        // Check if already logged in
        if (authToken) {
            checkAuth();
        } else {
            document.getElementById('login-screen').classList.remove('hidden');
        }

        async function checkAuth() {
            try {
                const response = await fetch('/api/auth/me', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (response.ok) {
                    currentUser = await response.json();
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('main-app').classList.remove('hidden');
                    document.getElementById('user-display').textContent = currentUser.username;
                    loadMyStrategies();
                } else {
                    localStorage.removeItem('authToken');
                    document.getElementById('login-screen').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                document.getElementById('login-screen').classList.remove('hidden');
            }
        }

        async function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token;
                    localStorage.setItem('authToken', authToken);
                    currentUser = data.user;
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('main-app').classList.remove('hidden');
                    document.getElementById('user-display').textContent = currentUser.username;
                    loadMyStrategies();
                } else {
                    alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ username –∏ –ø–∞—Ä–æ–ª—å.');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            }
        }

        function logout() {
            localStorage.removeItem('authToken');
            authToken = null;
            currentUser = null;
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'top-strategies') {
                loadTopStrategies();
            } else if (tabName === 'backtest') {
                loadBacktestStrategies();
            }
        }

        async function loadMyStrategies() {
            try {
                const response = await fetch('/api/strategies/my', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                displayStrategies(data.strategies, 'strategies-list');
            } catch (error) {
                console.error('Error loading strategies:', error);
                document.getElementById('strategies-list').innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π</p>';
            }
        }

        async function loadTopStrategies() {
            try {
                const response = await fetch('/api/strategies/top?limit=10');
                const strategies = await response.json();
                displayTopStrategies(strategies);
            } catch (error) {
                console.error('Error loading top strategies:', error);
            }
        }

        function displayStrategies(strategies, containerId) {
            const container = document.getElementById(containerId);
            if (strategies.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–π</p>';
                return;
            }
            
            container.innerHTML = strategies.map(s => `
                <div class="strategy-card ${s.rating >= 8 ? 'top-rated' : ''}">
                    <div class="strategy-header">
                        <div class="strategy-name">${s.strategy_name}</div>
                        <div class="rating">
                            ${'‚≠ê'.repeat(s.stars || 0)}
                            <span class="rating-number">${(s.rating || 0).toFixed(1)}/10</span>
                        </div>
                    </div>
                    <div class="strategy-metrics">
                        <div class="metric">
                            <span class="metric-label">ROI:</span>
                            <span class="metric-value ${s.best_roi > 0 ? 'profit' : 'loss'}">${(s.best_roi || 0).toFixed(2)}%</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Profit Factor:</span>
                            <span class="metric-value">${(s.best_profit_factor || 0).toFixed(2)}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Win Rate:</span>
                            <span class="metric-value">${((s.best_win_rate || 0) * 100).toFixed(1)}%</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–ü–ª–µ—á–æ:</span>
                            <span class="metric-value">${s.leverage}x</span>
                        </div>
                    </div>
                    <div class="strategy-actions">
                        <button class="btn btn-primary" onclick="editStrategy(${s.id})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-success" onclick="runBacktestForStrategy(${s.id})">üß™ –ë—ç–∫—Ç–µ—Å—Ç</button>
                        ${s.is_active ? '' : '<button class="btn" onclick="activateStrategy(' + s.id + ')">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>'}
                    </div>
                </div>
            `).join('');
        }

        function displayTopStrategies(strategies) {
            const container = document.getElementById('top-strategies-list');
            container.innerHTML = strategies.map(s => `
                <div class="top-strategy-item">
                    <h3>${s.strategy_name}</h3>
                    <div style="margin-top: 15px;">
                        <div>–†–µ–π—Ç–∏–Ω–≥: ${(s.rating || 0).toFixed(1)}/10 ${'‚≠ê'.repeat(s.stars || 0)}</div>
                        <div>ROI: ${(s.best_roi || 0).toFixed(2)}%</div>
                        <div>Profit Factor: ${(s.best_profit_factor || 0).toFixed(2)}</div>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 15px; width: 100%;" onclick="forkStrategy(${s.id})">üìã –§–æ—Ä–∫–Ω—É—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</button>
                </div>
            `).join('');
        }

        async function parseConfig() {
            const configText = document.getElementById('new-strategy-config').value;
            if (!configText.trim()) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏');
                return;
            }
            
            try {
                const response = await fetch('/api/strategies/parse', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ config_text: configText })
                });
                
                if (response.ok) {
                    const parsed = await response.json();
                    document.getElementById('config-preview').style.display = 'block';
                    document.getElementById('config-preview').textContent = JSON.stringify(parsed, null, 2);
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–æ–Ω—Ñ–∏–≥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç.');
                }
            } catch (error) {
                console.error('Parse error:', error);
                alert('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞');
            }
        }

        async function saveStrategy() {
            const name = document.getElementById('new-strategy-name').value;
            const desc = document.getElementById('new-strategy-desc').value;
            const balance = parseFloat(document.getElementById('new-strategy-balance').value);
            const leverage = parseInt(document.getElementById('new-strategy-leverage').value);
            const config = document.getElementById('new-strategy-config').value;
            
            if (!name || !config) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏');
                return;
            }
            
            try {
                const response = await fetch('/api/strategies', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        strategy_name: name,
                        description: desc,
                        config_text: config,
                        initial_balance: balance,
                        leverage: leverage
                    })
                });
                
                if (response.ok) {
                    alert('–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
                    switchTab('my-strategies');
                    loadMyStrategies();
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏');
                }
            } catch (error) {
                console.error('Save error:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
            }
        }

        async function runBacktest() {
            const strategyId = document.getElementById('backtest-strategy').value;
            const symbol = document.getElementById('backtest-symbol').value;
            
            if (!strategyId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é');
                return;
            }
            
            const resultsDiv = document.getElementById('backtest-results');
            resultsDiv.innerHTML = '<div class="loading">‚è≥ –ó–∞–ø—É—Å–∫ –±—ç–∫—Ç–µ—Å—Ç–∞...</div>';
            
            try {
                const response = await fetch('/api/backtest', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        strategy_id: parseInt(strategyId),
                        symbol: symbol
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    resultsDiv.innerHTML = `
                        <div class="card">
                            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ç–∫—Ç–µ—Å—Ç–∞</h3>
                            <div class="strategy-metrics">
                                <div class="metric">
                                    <span class="metric-label">ROI:</span>
                                    <span class="metric-value profit">${result.roi.toFixed(2)}%</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Profit Factor:</span>
                                    <span class="metric-value">${result.profit_factor.toFixed(2)}</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Win Rate:</span>
                                    <span class="metric-value">${(result.win_rate * 100).toFixed(1)}%</span>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = '<p style="color: #ef4444;">–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±—ç–∫—Ç–µ—Å—Ç–∞</p>';
                }
            } catch (error) {
                console.error('Backtest error:', error);
                resultsDiv.innerHTML = '<p style="color: #ef4444;">–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>';
            }
        }

        async function loadBacktestStrategies() {
            try {
                const response = await fetch('/api/strategies/my', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                const select = document.getElementById('backtest-strategy');
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</option>' +
                    data.strategies.map(s => 
                        `<option value="${s.id}">${s.strategy_name}</option>`
                    ).join('');
            } catch (error) {
                console.error('Error loading strategies for backtest:', error);
            }
        }
    </script>
</body>
</html>

