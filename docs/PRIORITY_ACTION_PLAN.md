# –ü–ª–∞–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ vs –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –û–¢–õ–û–ñ–ò–¢–¨ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

### –ü–æ—á–µ–º—É –ù–ï —Å–µ–π—á–∞—Å:

#### 1. **–ï—Å—Ç—å –±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã** (–∏–∑ `next_prompt.md`)
- ‚ö†Ô∏è `std::sync::Mutex` –≤ async –∑–∞–¥–∞—á–∞—Ö - –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å deadlocks
- ‚ö†Ô∏è –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ retries –¥–æ 30 —Å–µ–∫—É–Ω–¥ - –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è HFT
- ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –ø—É—Ç–∏
- ‚ö†Ô∏è WebSocket –æ—à–∏–±–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

#### 2. **–ù–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**
- TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å RSI —Ä–∞—Å—á–µ—Ç (—Å–µ–π—á–∞—Å –∑–∞–≥–ª—É—à–∫–∞)
- TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å MACD —Ä–∞—Å—á–µ—Ç (—Å–µ–π—á–∞—Å –∑–∞–≥–ª—É—à–∫–∞)
- TODO: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å BTC —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Å runner
- TODO: –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Å–∫—Ä–∏–Ω–µ—Ä

#### 3. **–ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –†–ê–ë–û–¢–ê–Æ–¢**
- `engine.rs` (1992 —Å—Ç—Ä–æ–∫–∏) - —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ
- `quote_raw.rs` (1428 —Å—Ç—Ä–æ–∫) - —Ä–∞–±–æ—Ç–∞–µ—Ç, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å —Ä–∞–±–æ—Ç–∞—é—â–∏–π –∫–æ–¥

#### 4. **–ü—Ä–æ–µ–∫—Ç –≤ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ**
- –ï—Å—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–π–º–µ—Ç 2-3 –Ω–µ–¥–µ–ª–∏
- –≠—Ç–æ –æ—Ç–ª–æ–∂–∏—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤–∞–∂–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## üìã –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:

### –§–∞–∑–∞ 1: –ö–†–ò–¢–ò–ß–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (–°–ï–ô–ß–ê–°)

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å async mutexes** (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
   ```rust
   // –ë–´–õ–û (–ø–ª–æ—Ö–æ):
   use std::sync::Mutex;
   
   // –î–û–õ–ñ–ù–û –ë–´–¢–¨:
   use tokio::sync::Mutex;
   ```
   –§–∞–π–ª—ã: `src/base_classes/state.rs`, `src/execution/gate_ws.rs`

2. **–£–ª—É—á—à–∏—Ç—å retry –ª–æ–≥–∏–∫—É**
   - –£–±—Ä–∞—Ç—å –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ sleep –¥–æ 30 —Å–µ–∫—É–Ω–¥
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å exponential backoff –≤ async –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å**
   - –ò–∑–±–µ–≥–∞—Ç—å `SystemTime::now()` –≤ hot loops
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å monotonic clocks
   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

**–ö–æ–º–º–∏—Ç—ã**:
- `fix: replace std::sync::Mutex with tokio::sync::Mutex`
- `perf: optimize critical path timing`
- `fix: improve websocket reconnection logic`

### –§–∞–∑–∞ 2: –ó–ê–í–ï–†–®–ò–¢–¨ –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ (–°–õ–ï–î–£–Æ–©–ò–ï 1-2 –ù–ï–î–ï–õ–ò)

1. **–î–æ—Ä–∞–±–æ—Ç–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å RSI —Ä–∞—Å—á–µ—Ç
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å MACD —Ä–∞—Å—á–µ—Ç
   
2. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å BTC —Å—Ç—Ä–∞—Ç–µ–≥–∏—é**
   - –°–æ–∑–¥–∞—Ç—å `src/bin/btc_runner.rs`
   - –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ

3. **–î–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Å–∫—Ä–∏–Ω–µ—Ä**
   - –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è —Å–∏–≥–Ω–∞–ª–æ–≤
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏

**–ö–æ–º–º–∏—Ç—ã**:
- `feat: implement RSI calculation`
- `feat: implement MACD calculation`
- `feat: create BTC trading strategy runner`
- `feat: enhance screener with filters`

### –§–∞–∑–∞ 3: –†–ï–§–ê–ö–¢–û–†–ò–ù–ì (–ö–û–ì–î–ê –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ –ì–û–¢–û–í–ê)

**–ö–æ–≥–¥–∞ –¥–µ–ª–∞—Ç—å:**
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –ö–æ–≥–¥–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –í —Å–ø–æ–∫–æ–π–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –¥–ª—è —Ç–µ—Ö–¥–æ–ª–≥–∞

**–ö–∞–∫ –¥–µ–ª–∞—Ç—å:**
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ, –æ–¥–∏–Ω —Ñ–∞–π–ª –∑–∞ —Ä–∞–∑
- –í –æ—Ç–¥–µ–ª—å–Ω–æ–π –≤–µ—Ç–∫–µ
- –° —Ç—â–∞—Ç–µ–ª—å–Ω—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –ú–∞–ª–µ–Ω—å–∫–∏–º–∏ –∫–æ–º–º–∏—Ç–∞–º–∏

## üéØ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –°–ï–ô–ß–ê–°:

### ‚úÖ –î–ª—è –ù–û–í–´–• —Ñ–∞–π–ª–æ–≤:
- **–°—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞—Ç—å** –ª–∏–º–∏—Ç 300-500 —Å—Ç—Ä–æ–∫ (–∏–¥–µ–∞–ª)
- –†–∞–∑–±–∏–≤–∞—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏ —Å—Ä–∞–∑—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- –°–ª–µ–¥–æ–≤–∞—Ç—å `.cursorrules` –¥–ª—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### ‚úÖ –ü—Ä–∏ –†–ê–°–®–ò–†–ï–ù–ò–ò —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö:
- –ï—Å–ª–∏ —Ñ–∞–π–ª < 800 —Å—Ç—Ä–æ–∫ - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å
- –ï—Å–ª–∏ —Ñ–∞–π–ª > 800 —Å—Ç—Ä–æ–∫ - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å —Ä—è–¥–æ–º
- –ù–µ —Ç—Ä–æ–≥–∞—Ç—å –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### ‚úÖ –ü—Ä–∏ –ë–ê–ì–§–ò–ö–°–ê–•:
- –ò—Å–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ—á–µ—á–Ω–æ, –Ω–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –≤–µ—Å—å —Ñ–∞–π–ª
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–Ω–æ–≥–æ –∫–æ–¥–∞ - –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

```
–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:     [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë] 4 –∑–∞–¥–∞—á–∏
–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π:     [‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 3-4 –∑–∞–¥–∞—á–∏
–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–æ–ª—å—à–∏—Ö:    [‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 0 –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
```

## üöÄ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 2 –Ω–µ–¥–µ–ª–∏:

### –ù–µ–¥–µ–ª—è 1:
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `std::sync::Mutex` ‚Üí `tokio::sync::Mutex`
2. ‚úÖ –£–ª—É—á—à–∏—Ç—å retry –ª–æ–≥–∏–∫—É –¥–ª—è WebSocket
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å RSI —Ä–∞—Å—á–µ—Ç

### –ù–µ–¥–µ–ª—è 2:
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å MACD —Ä–∞—Å—á–µ—Ç
2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å BTC —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
3. ‚úÖ –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Å–∫—Ä–∏–Ω–µ—Ä

### –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ:
- –û—Ü–µ–Ω–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –ù–∞—á–∞—Ç—å —Å `engine.rs` –µ—Å–ª–∏ –±—É–¥–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ

## ‚ö†Ô∏è –í–∞–∂–Ω–æ:

**–ù–ï —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã, –µ—Å–ª–∏:**
- –ï—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏
- –ï—Å—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –ü—Ä–æ–µ–∫—Ç –≤ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è

**–†–ï–§–ê–ö–¢–û–†–ò–¢–¨ —Å—Ç–æ–∏—Ç, –µ—Å–ª–∏:**
- –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Ä–µ—à–µ–Ω—ã
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–∞
- –ï—Å—Ç—å –≤—Ä–µ–º—è –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–æ–º–∞–Ω–¥–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º

## üìù –ò—Ç–æ–≥:

**–í–µ—Ä–¥–∏–∫—Ç: –û–¢–õ–û–ñ–ò–¢–¨ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤**

**–î–µ–π—Å—Ç–≤–∏—è –°–ï–ô–ß–ê–°:**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ async –ø—Ä–æ–±–ª–µ–º—ã
2. –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
3. –ü—Ä–∏–º–µ–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∫ –Ω–æ–≤—ã–º —Ñ–∞–π–ª–∞–º
4. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ –±—É–¥—É—â–µ–µ

**–ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (`REFACTORING_PLAN.md`) —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å** - –æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–æ–∑–∂–µ, –∫–æ–≥–¥–∞ –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ.

